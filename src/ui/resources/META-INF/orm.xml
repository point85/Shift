<?xml version="1.0" encoding="UTF-8"?>

<entity-mappings version="2.1"
	xmlns="http://www.eclipse.org/eclipselink/xsds/persistence/orm"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

	<package>org.point85.workschedule</package>

	<!-- WorkSchedule table -->
	<entity class="WorkSchedule" access="FIELD">
	<table name="WORK_SCHEDULE" />
		<attributes>
			<!-- primary key -->
			<id name="primaryKey" attribute-type="Integer">
				<column name="WS_KEY" />
				<generated-value strategy="IDENTITY"/>
			</id>
			
			<!-- version -->
			<version name="version" >
				<column name="VERSION"/> 
			</version>
			
			<!-- name -->
			<basic name="name" attribute-type="String">
				<column name="NAME" />
			</basic>
			
			<!-- description -->
			<basic name="description" attribute-type="String">
				<column name="DESCRIPTION" />
			</basic>
			
			<!-- list of shifts -->
			<one-to-many name="shifts" orphanRemoval="true" fetch="EAGER"  target-entity="Shift" mapped-by="workSchedule">
				<private-owned/>
				<cascade>
					<cascade-all/>
				</cascade>	
			</one-to-many>	
			
			<!-- list of teams -->
			<one-to-many name="teams" orphanRemoval="true" fetch="EAGER"  target-entity="Team" mapped-by="workSchedule">
				<private-owned/>
				<cascade>
					<cascade-all/>
				</cascade>	
			</one-to-many>	
			
			<!-- list of non-working periods -->
			<one-to-many name="nonWorkingPeriods" orphanRemoval="true" fetch="EAGER"  target-entity="NonWorkingPeriod" mapped-by="workSchedule">
				<private-owned/>
				<cascade>
					<cascade-all/>
				</cascade>	
			</one-to-many>	
								
		</attributes>
	</entity>
	
	<!-- Shift table -->
	<entity class="Shift" access="FIELD">
	<table name="SHIFT" />
		<attributes>
			<!-- primary key -->
			<id name="primaryKey" attribute-type="Integer">
				<column name="SHIFT_KEY"/>
				<generated-value strategy="IDENTITY"/>
			</id>
			
			<!-- name -->
			<basic name="name" attribute-type="String">
				<column name="NAME" />
			</basic>
			
			<!-- description -->
			<basic name="description" attribute-type="String">
				<column name="DESCRIPTION" />
			</basic>
			
			<!-- start time -->
			<basic name="startTime">
				<column name="START_TIME" />
			</basic>
			
			<!-- duration-->
			<basic name="duration">
				<column name="DURATION" />
			</basic>
			
			<!-- work schedule -->
			<many-to-one name="workSchedule" fetch="EAGER">
            	<join-column name="WS_KEY"/>
        	</many-to-one>
			
			<!-- transient attributes -->
			<transient name="breaks"/>
								
		</attributes>
	</entity>
	
	<!-- Team table -->
	<entity class="Team" access="FIELD">
	<table name="TEAM" />
		<attributes>
			<!-- primary key -->
			<id name="primaryKey" attribute-type="Integer">
				<column name="TEAM_KEY"/>
				<generated-value strategy="IDENTITY"/>
			</id>
			
			<!-- name -->
			<basic name="name" attribute-type="String">
				<column name="NAME" />
			</basic>
			
			<!-- description -->
			<basic name="description" attribute-type="String">
				<column name="DESCRIPTION" />
			</basic>
			
			<!-- rotation -->
			<one-to-one name="rotation" orphanRemoval="true" fetch="EAGER" target-entity="Rotation">
				<private-owned/>
				<join-column name="ROTATION_KEY"/>
				<cascade>
					<cascade-all/>
				</cascade>	
			</one-to-one>
			
			<!-- rotation start-->
			<basic name="rotationStart">
				<column name="ROTATION_START" />
			</basic>
			
			<!-- work schedule -->
			<many-to-one name="workSchedule" fetch="EAGER">
            	<join-column name="WS_KEY"/>
        	</many-to-one>
								
		</attributes>
	</entity>
	
	<!-- rotation table -->
	<entity class="Rotation" access="FIELD">
	<table name="ROTATION" />
		<attributes>
			<!-- primary key -->
			<id name="primaryKey" attribute-type="Integer">
				<column name="ROTATION_KEY"/>
				<generated-value strategy="IDENTITY"/>
			</id>
			
			<!-- name -->
			<basic name="name" attribute-type="String">
				<column name="NAME" />
			</basic>
			
			<!-- description -->
			<basic name="description" attribute-type="String">
				<column name="DESCRIPTION" />
			</basic>
			
			<!-- list of segments -->
			<one-to-many name="rotationSegments" orphanRemoval="true" fetch="EAGER"  target-entity="RotationSegment" mapped-by="rotation">
				<private-owned/>
				<cascade>
					<cascade-all/>
				</cascade>	
			</one-to-many>	
			
			<!-- transient attributes -->
			<transient name="periods"/>
								
		</attributes>
	</entity>
	
	<!-- Rotation segment table -->
	<entity class="RotationSegment" access="FIELD">
	<table name="ROTATION_SEGMENT" />
		<attributes>
			<!-- primary key -->
			<id name="primaryKey" attribute-type="Integer">
				<column name="SEGMENT_KEY"/>
				<generated-value strategy="IDENTITY"/>
			</id>
			
			<!-- sequence -->
			<basic name="sequence" attribute-type="Integer">
				<column name="SEQUENCE" />
			</basic>
			
			<!-- rotation parent -->
			<many-to-one name="rotation" fetch="EAGER">
            	<join-column name="ROTATION_KEY"/>
        	</many-to-one>
			
			<!-- starting shift -->
			<one-to-one name="startingShift" orphanRemoval="true" fetch="EAGER" target-entity="Shift">
				<private-owned/>
				<join-column name="SHIFT_KEY"/>
				<cascade>
					<cascade-all/>
				</cascade>	
			</one-to-one>
			
			<!-- days on -->
			<basic name="daysOn" attribute-type="Integer">
				<column name="DAYS_ON" />
			</basic>
			
			<!-- days off -->
			<basic name="daysOff" attribute-type="Integer">
				<column name="DAYS_OFF" />
			</basic>
		</attributes>
	</entity>
	
	<!-- Non-working time table -->
	<entity class="NonWorkingPeriod" access="FIELD">
	<table name="NON_WORKING_PERIOD" />
		<attributes>
			<!-- primary key -->
			<id name="primaryKey" attribute-type="Integer">
				<column name="PERIOD_KEY"/>
				<generated-value strategy="IDENTITY"/>
			</id>
			
			<!-- name -->
			<basic name="name" attribute-type="String">
				<column name="NAME" />
			</basic>
			
			<!-- description -->
			<basic name="description" attribute-type="String">
				<column name="DESCRIPTION" />
			</basic>
			
			<!-- start date and time -->
			<basic name="startDateTime">
				<column name="START_DATE_TIME" />
			</basic>
			
			<!-- duration-->
			<basic name="duration">
				<column name="DURATION" />
			</basic>
			
			<!-- work schedule -->
			<many-to-one name="workSchedule" fetch="EAGER">
            	<join-column name="WS_KEY"/>
        	</many-to-one>	
		</attributes>
	</entity>
		
	<named-query name="WS.ByName">
		<query>SELECT ws FROM WorkSchedule ws WHERE ws.name = :name</query>
	</named-query>
	
	<named-query name="WS.ByKey">
		<query>SELECT ws FROM WorkSchedule ws WHERE ws.primaryKey = :key</query>
	</named-query>
	
	<named-query name="WS.Names">
		<query>SELECT ws.name FROM WorkSchedule ws</query>
	</named-query>
	
	<named-query name="TEAM.ByKey">
		<query>SELECT team FROM Team team WHERE team.primaryKey = :key</query>
	</named-query>
	
	<named-native-query name="ROTATION.CrossRef">
		<query>select TEAM_KEY from TEAM where ROTATION_KEY = ?1</query>
	</named-native-query>
	
</entity-mappings>